# 概要
`output/タマネギアプリ/設計/バックエンド/パーソナリティ中心コア機能設計.md`は、パーソナリティ表現を起点にエピソードマッチング・対話エージェント・イベント生成を連携させるバックエンド設計の指針をまとめたレポート。

# 目的
- パーソナリティデータを単一サービスで管理し、各機能が一貫したシグナルを参照できるようにする。
- 各モジュールでの利用方法（アルゴリズム・API・データ構造）のたたきを提示し、次フェーズの詳細設計をスムーズにする。

# 最適な実装方法
1. Baseline/Narrative/Stateの3層モデルでパーソナリティを保持。
2. Matching・対話・イベントの各モジュールは、専用オーケストレーターとプロンプト/スコアリングロジックからProfile Serviceを参照する。
3. フィードバックループ（リフレクションや成功イベント）でプロファイルを継続的に更新する。

# 最適と思われる理由
- 中央集権的なProfile管理により、トーンや安全ガードの整合性を確保できる。
- 3モジュールの評価指標を統合しやすく、改善サイクルを回しやすい。

# 入出力
- 入力: オンボーディング回答、エピソードメタデータ、リフレクションログ、イベントフィードバック。
- 出力: マッチングスコア、パーソナライズされた対話レスポンス、イベント提案。

# 実装の評価
- 各モジュールでパーソナリティが反映された結果指標（Comfortスコア、Persona Fit、イベント満足度）が向上しているか。
- 安全プロトコルが一貫して動作し、危機検知・クールダウンの意図が守られているか。
