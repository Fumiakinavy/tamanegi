# タマネギアプリ Design

## 体験フロー（要約）
- **エピソード登録**: ホーム→「育てる」→対話エージェントで分割質問→Depth/テーマ/辛さを確定→草稿リライト→保存。
- **皮を剥く（pillar）**: ホーム→「剥がす」→マッチ候補と理由提示→相互承認→セッション実施→リフレクション→ポイント確定。
- **フォロワー導線**: フレンド管理→履歴/招待→承認後ホームへ戻る。

## インタラクション要件
- 対話エージェントは「深さごとに質問束」をステップ表示し、途中保存とクールダウンをサポート。
- 非対称エピソード解錠: 片側がエピソードを持つ場合、持ち主の承認で閲覧/対話開始。承認モーダルに「期待行動（時間・態度）」「拒否オプション」を明示。
- pillar進捗UI: セッション画面に控えめなゲージと「信頼が上がりました」等の文言を提示し、金銭報酬の直接表現を避ける。

## スコアリング草案（オフチェーン）
```
reward = cap(
  base * depth_w * hardship_w * mutuality_w * listening_time_m,
  daily_cap
)

depth_w      = min(1 + depth/7, 1.5)
hardship_w   = bounded self-report (0.8–1.6) * listener_agreement (0.7–1.1)
mutuality_w  = 1.0 if both share same depth, else 0.7
listening_time_m = minutes listened (max 40)
cooldown: after depth>=5, apply 12–24h cooldown before next high-depth session
```
- 報酬期待値は地域最低賃金未満になるよう`base`を調整。SBTに履歴を刻み、後日Onion Tokenへ変換可能にする。

## トークン&データ設計
- **Onion SBT**: 非譲渡。メタデータにエピソードIDハッシュ、深さ帯、日時、相互性フラグ、ポイントを記録。開示スコープを「本人限定/フレンド/監査/公開」から選択。
- **Onion Token**: 流通可。週次でpillarポイントを一定レートでスワップ可能。マクロ難易度調整（総pillar量が増えると発行レートを逓減）。

## 安全設計
- セッション前チェックイン（気分/安全度）。低スコア時は係数を下げ、緊急リソースを提示。
- モデレーション: 危険語/自傷兆候で即クールダウン＋サポートカード表示。
- 虚偽・誇張防止: 聴き手NPS、再現性チェック、連投時の減衰係数。

## IA/画面ラフ
- Home: 3 CTA（育てる/剥がす/フォロワー）＋軽いステータスカード（本日のpillar進捗）。
- Episode Editor: ステップ式ウィザード＋AI提案パネル、深さスライダー。
- Pillar Session: マッチ理由、期待行動チェックリスト、セッションメモ、リフレクション入力、ポイント確定トースト。
- History: SBT風のタイムライン。深さ帯は抽象化（例: Leaf/Peel/Core）で直接的な辛さ表示を避ける。

## 開発フェーズ
1. オフチェーンポイント＋SBTモック（譲渡なし）でUX検証。
2. 日次上限/クールダウンとモデレーションのチューニング。
3. トークンブリッジ（任意チェーン）とZK/選択的開示の実装。

## 計測
- セッション完遂率、リフレクション入力率、聴き手NPS、虚偽疑義率、クールダウン発動率。
- トークン経済: 発行/焼却、未スワップポイント残高、SBT開示率。
